<!-- templates/report.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Lottery Optimizer — Report</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;max-width:980px;margin:28px auto;padding:0 16px;color:#111}
    h1{font-size:26px;margin:0 0 16px}
    h2{font-size:18px;margin:24px 0 12px}
    .card{border:1px solid #e6e6e6;border-radius:10px;padding:16px;margin:12px 0}
    .btn{display:inline-block;background:#111;color:#fff;padding:8px 14px;border-radius:8px;border:none;cursor:pointer}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    input[type=text]{width:100%;padding:8px;border:1px solid #ccc;border-radius:8px}
    label{font-size:12px;color:#555}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .error{background:#fff4f4;border:1px solid #ffd4d4;color:#a40000;padding:12px;border-radius:8px;white-space:pre-wrap}
    pre{background:#111;color:#fff;padding:10px;border-radius:8px;overflow:auto}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{border:1px solid #eee;padding:6px 8px;font-family:ui-monospace, SFMono-Regular, Menlo, monospace}
    .muted{color:#666}
  </style>
</head>
<body>
  <h1>Lottery Optimizer — Report</h1>

  {% if import_err %}
  <div class="error"><strong>Import error:</strong>\n{{ import_err }}</div>
  {% endif %}

  {% if error %}
  <div class="error"><strong>Error:</strong>\n{{ error }}</div>
  {% endif %}

  <div class="card">
    <h2>Run Phase 1 &amp; 2</h2>
    <form method="post" action="/run-phase12">
      <div class="row">
        <div>
          <label>LATEST_MM (e.g. "[10,14,34,40,43],5")</label>
          <input name="LATEST_MM" type="text" placeholder="[10,14,34,40,43],5">
        </div>
        <div>
          <label>LATEST_PB (e.g. "[14,15,32,42,49],1")</label>
          <input name="LATEST_PB" type="text" placeholder="[14,15,32,42,49],1">
        </div>
      </div>
      <div class="row">
        <div><label>LATEST_IL_JP</label><input name="LATEST_IL_JP" type="text" placeholder="[1,4,5,10,18,49]"></div>
        <div><label>LATEST_IL_M1</label><input name="LATEST_IL_M1" type="text" placeholder="[6,8,10,18,26,27]"></div>
      </div>
      <div class="row">
        <div><label>LATEST_IL_M2</label><input name="LATEST_IL_M2" type="text" placeholder="[2,18,21,27,43,50]"></div>
        <div><label>Runs (default 100)</label><input name="RUNS" type="text" value="100"></div>
      </div>
      <div style="margin-top:10px">
        <label><input type="checkbox" name="QUIET" checked> Quiet progress (10/100, …)</label>
      </div>
      <div style="margin-top:12px"><button class="btn" type="submit">Run Phase 1 &amp; 2</button></div>
      <p class="muted">Generates a 50-row batch for each game, prints Phase-1 hits, runs sims, and saves “buy_session_*.json”.</p>
    </form>
  </div>

  <div class="card">
    <h2>Confirm Phase 3</h2>
    <form method="post" action="/confirm-phase3">
      <div><label>Saved buy list path (e.g., /tmp/buylists/buy_session_YYYYMMDD_HHMMSS.json)</label>
        <input name="CONFIRM_FILE" type="text" placeholder="/tmp/buylists/buy_session_*.json">
      </div>
      <div class="row" style="margin-top:8px">
        <div><label>NWJ_MM</label><input name="NWJ_MM" type="text" placeholder="[10,14,34,40,43],5"></div>
        <div><label>NWJ_PB</label><input name="NWJ_PB" type="text" placeholder="[14,15,32,42,49],1"></div>
      </div>
      <div class="row">
        <div><label>NWJ_IL_JP</label><input name="NWJ_IL_JP" type="text" placeholder="[2,7,25,30,44,49]"></div>
        <div><label>NWJ_IL_M1</label><input name="NWJ_IL_M1" type="text" placeholder="[10,20,22,23,24,39]"></div>
      </div>
      <div class="row">
        <div><label>NWJ_IL_M2</label><input name="NWJ_IL_M2" type="text" placeholder="[3,13,19,25,32,33]"></div>
        <div><label><input type="checkbox" name="RECALL_PHASE12" checked> Also recall Phase-1/2 headings</label></div>
      </div>
      <div style="margin-top:12px"><button class="btn" type="submit">Confirm Phase 3</button></div>
      <p class="muted">Compares only against the exact tickets stored in that saved JSON.</p>
    </form>
  </div>

  {% if res %}
    <div class="card">
      <h2>Result</h2>
      <pre>{{ res | tojson(indent=2) }}</pre>
    </div>
  {% else %}
    <p class="muted">Fill the form and click <b>Run</b> to see results.</p>
  {% endif %}

  <div class="card">
    <h2>Recent buy lists</h2>
    <div class="muted">None yet.</div>
    <p class="muted">Tip: set an <code>APP_KEY</code> env var and send it as header <code>X-App-Key</code> for basic protection.</p>
  </div>
</body>
</html>
